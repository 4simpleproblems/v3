<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>4SP | Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="firebase-config.js"></script>

  <style>
    /* Base styles from index.html for consistency */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto Mono', monospace;
      background-color: #f5f5f5; /* Matching index.html body background */
      color: #333; /* Matching index.html text color */
      line-height: 1.6;
      display: flex; /* Keep flexbox for full height dashboard */
      flex-direction: column;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px; /* Matching index.html container padding */
      flex: 1; /* Allow main content to grow */
    }

    /* Navbar - Adopted from index.html */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px; /* Matching index.html navbar padding */
      background-color: #111; /* Matching index.html navbar background */
      color: #fff;
      /* border-bottom removed for cleaner look like index.html */
    }
    .logo {
      font-size: 24px; /* Matching index.html logo font size */
      font-weight: 700;
      /* letter-spacing removed as it was specific to dashboard.html */
    }
    .nav-buttons {
      display: flex;
      gap: 10px; /* Matching index.html nav buttons gap */
      align-items: center; /* Ensure alignment */
    }

    /* Buttons - Adopted from index.html */
    .btn {
      padding: 8px 16px; /* Matching index.html button padding */
      border-radius: 30px; /* Matching index.html button border-radius */
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease; /* Matching index.html button transition */
      border: none; /* Default no border, specific types will override */
      font-family: 'Roboto Mono', monospace; /* Ensure font consistency */
      display: inline-block; /* For consistency as some were links */
      text-align: center; /* Ensure text is centered */
    }
    .btn.primary {
      background-color: #4285F4; /* Matching index.html primary button */
      color: #fff;
      border: 1px solid; /* Index.html primary has border but no color specified */
    }
    .btn.secondary {
      background-color: transparent;
      color: white;
      border: 1px solid white; /* Matching index.html secondary button */
    }
    /* .btn.tips was unique to dashboard, adapting to primary style */
    .btn.tips {
      background-color: #4285F4;
      color: #fff;
      border: 1px solid;
    }

    .btn.primary:hover {
      background-color: #3367d6; /* Matching index.html primary hover */
    }
    .btn.secondary:hover {
      background-color: rgba(255,255,255,0.1); /* Matching index.html secondary hover */
    }
    /* Ensure logout button matches the secondary style */
    #logoutBtn {
      background-color: transparent;
      color: white;
      border: 1px solid white;
    }
    #logoutBtn:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .hidden {
      display: none !important;
    }

    /* Dashboard Content Card - Inspired by index.html's .home-container */
    .dashboard-content-card {
      width: 100%;
      max-width: 900px; /* Can be adjusted if more width is desired for dashboard content */
      margin: 40px auto; /* Center the card */
      background-color: #fff;
      border-radius: 30px; /* Matching index.html home-container border-radius */
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Matching index.html home-container shadow */
      overflow: hidden;
      padding: 40px 30px; /* Matching index.html home-container padding */
      /* Removed text-align: center to allow grid items to align naturally */
    }

    /* Section headers */
    .section-header {
      margin: 3rem 0 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 3px solid #3498db; /* Keeping original section color */
      color: #333; /* Matching index.html general text color */
      font-weight: 700;
      font-size: 1.5rem;
    }
    .section-header:first-of-type {
      margin-top: 1rem;
    }

    /* Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }
    /* Special case for 2-tile sections */
    .dashboard-grid:has(:nth-child(2):last-child) {
      grid-template-columns: repeat(2, 1fr);
    }
    /* Media queries for responsive grid (kept as is, already well-designed) */
    @media (min-width: 992px) {
      .dashboard-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .dashboard-grid:has(:nth-child(2):last-child) {
        grid-template-columns: repeat(2, 1fr);
      }
      .dashboard-grid:has(:first-child:last-child) {
        grid-template-columns: 1fr;
      }
    }
    @media (min-width: 768px) and (max-width: 991px) {
      .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .dashboard-grid:has(:first-child:last-child) {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 767px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Tiles - Adjusted for index.html look */
    .dashboard-tile {
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: white;
      border-radius: 30px; /* Matching index.html home-container border-radius */
      padding: 2.5rem;
      text-decoration: none;
      color: #333; /* Matching index.html general text color */
      overflow: hidden;
      height: 280px; /* Keeping original tile height */
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid #e0e0e0; /* Softer border, similar to index.html's subtle lines */
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Matching index.html home-container shadow */
      width: 100%;
    }
    .dashboard-tile .tile-content {
      position: relative;
      z-index: 2;
    }
    .dashboard-tile h3 {
      font-size: 1.6rem;
      margin-bottom: 1rem;
      font-weight: 600;
    }
    .dashboard-tile p {
      font-size: 1rem;
      line-height: 1.6;
    }
    .dashboard-tile .tile-frame {
      position: absolute;
      inset: 0;
      border: 3px solid rgba(0, 0, 0, 0.08); /* Softer inner border */
      border-radius: 28px; /* Slightly smaller than tile for visual effect */
      z-index: 1;
      transition: border-color 0.3s ease;
    }
    .dashboard-tile:hover {
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
    .dashboard-tile:hover .tile-frame {
      border-color: #333; /* Darker border on hover for consistency */
    }

    /* Games tile now matches default white */
    .games-tile {
      background-color: white;
      border-color: #e0e0e0;
    }

    /* Footer - Adopted from index.html */
    footer {
      text-align: center;
      padding: 20px; /* Matching index.html footer padding */
      color: #666; /* Matching index.html footer color */
      font-size: 14px; /* Matching index.html footer font size */
    }

    /* Modal (Keeping original styles as they were separate) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        animation: fadeIn 0.3s forwards; /* Fade-in animation */
    }

    .modal.fade-out {
        animation: fadeOut 0.3s forwards; /* Fade-out animation */
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }

    .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more responsive */
        max-width: 500px; /* Max width */
        border-radius: 8px;
        position: relative; /* For positioning close button */
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        animation: slideInTop 0.3s forwards ease-out;
    }

    @keyframes slideInTop {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close-button:hover,
    .close-button:focus {
        color: #000;
        text-decoration: none;
    }
    .modal-content h2 {
      margin-bottom: 15px;
      font-size: 1.5rem;
      color: #333;
    }
    .modal-content p {
      margin-bottom: 10px;
      font-size: 0.95rem;
      color: #555;
    }
    .modal-content ul {
      margin-left: 20px;
      margin-bottom: 15px;
      list-style-type: disc;
    }
    .modal-content li {
      margin-bottom: 5px;
      color: #555;
    }
    .modal-content .btn {
      margin-top: 20px;
    }

  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">4SP</div>
    <div class="nav-buttons">
      <a href="legal-list.html" class="btn secondary">Legal</a>
      <a href="dashboard.html" class="btn secondary" id="dashboardNavBtn">Dashboard</a>
      <button class="btn primary" id="logoutBtn">Log Out</button>
    </div>
  </nav>

  <main class="container">
    <div class="dashboard-content-card">
      <h1 class="hidden" id="authNotice">Please login to access your dashboard</h1>

      <h2 class="section-header">Media & Entertainment</h2>
      <div class="dashboard-grid">
        <a href="soundboard.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Soundboard</h3>
            <p>Access all available sound clips and categories. Play, hear, and admire these amazing sounds.</p>
          </div>
          <div class="tile-frame"></div>
        </a>

        <a href="playlist.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Playlists (Beta)</h3>
            <p>Access and store sounds you like.</p>
          </div>
          <div class="tile-frame"></div>
        </a>

        <a href="localsounds.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Local Sounds</h3>
            <p>Upload and play your own local MP3 files.</p>
          </div>
          <div class="tile-frame"></div>
        </a>

        <a href="https://4simpleproblems.github.io/game/" target="_blank" rel="noopener" class="dashboard-tile">
          <div class="tile-content">
            <h3>Games</h3>
            <p>Play a variety of browser games from our curated collection.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
      </div>

      <h2 class="section-header">Web Access</h2>
      <div class="dashboard-grid">
        <a href="vern.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Vern</h3>
            <p>The official proxy for 4SP.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
        <a href="links.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Links</h3>
            <p>Uploaded links by 4SP, including Eaglercraft, and other crap.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
      </div>

      <h2 class="section-header">User Interaction</h2>
      <div class="dashboard-grid">
        <a href="requests.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Request a Sound</h3>
            <p>Submit requests for new sounds to be added to the collection. Sounds may be approved or denied.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
        <a href="collections.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Sound Request Collection</h3>
            <p>View sound requests organized by category.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
        <a href="feedback.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Feedback</h3>
            <p>Suggest user feedback, new features, or proxy reports to 4SP for improvement in the website.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
      </div>

      <h2 class="section-header">User Settings</h2>
      <div class="dashboard-grid">
        <a href="account.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Account</h3>
            <p>Manage and view your account settings and preferences. Updating your entire profile with usernames will be in the future.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
        <a href="legal-list.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Legal & Policies</h3>
            <p>Legal center for our website, including privacy policy and our terms of service.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
      </div>

      <h2 class="section-header">Others</h2>
      <div class="dashboard-grid">
        <a href="schedule.html" class="dashboard-tile">
          <div class="tile-content">
            <h3>Working Schedule</h3>
            <p>A working schedule from which websites will be updated.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
        <a href="https://optana-web.github.io/" target="_blank" rel="noopener" class="dashboard-tile">
          <div class="tile-content">
            <h3>Optana Website</h3>
            <p>A website I created based around wishlists. I would be able to make wishlists, and edit them so people know what I want. This is currently in alpha.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
      </div>

      <h2 class="section-header hidden" id="adminSectionHeader">Admin Controls</h2>
      <div class="dashboard-grid hidden" id="adminSection">
        <a href="feedback-collections.html" class="dashboard-tile admin-tile" id="analyticsTile">
          <div class="tile-content">
            <h3>Feedback Collection</h3>
            <p>Access user feedback and suggestions.</p>
          </div>
          <div class="tile-frame"></div>
        </a>
      </div>
    </div>
  </main>

  <div id="tipsModal" class="modal">
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="modal-content">
      <span class="close-button" id="closeModalBtn">&times;</span>
      <h2>Welcome to the Dashboard!</h2>
      <p>Here are some tips to get started:</p>
      <ul>
        <li>Navigate through different sections using the tiles.</li>
        <li>The "Soundboard" is where you'll find all the sounds.</li>
        <li>"Vern" is our secure proxy for web access.</li>
        <li>You can request new sounds or provide feedback on the site.</li>
        <li>Manage your account settings under "User Settings".</li>
      </ul>
      <button class="btn primary" id="gotItBtn">Got it!</button>
    </div>
  </div>

  <footer><p>© 2025 4SP</p></footer>
    <script>
        // Authentication state management
        function handleAuthState(user) {
            const authNotice = document.getElementById('authNotice');
            // Select the new dashboard-content-card instead of individual grid sections
            const dashboardContentCard = document.querySelector('.dashboard-content-card');
            const logoutBtn = document.getElementById('logoutBtn');
            const adminSectionHeader = document.getElementById('adminSectionHeader');
            const adminSection = document.getElementById('adminSection');
            const adminEmail = '4simpleproblems@gmail.com'; // Replace with your admin email

            if (user) {
                authNotice.classList.add('hidden');
                // Show the dashboard content card if user is logged in
                if (dashboardContentCard) {
                    dashboardContentCard.classList.remove('hidden');
                }
                if (logoutBtn) logoutBtn.classList.remove('hidden');

                // Check if user is admin
                if (user.email === adminEmail) {
                    adminSectionHeader.classList.remove('hidden');
                    adminSection.classList.remove('hidden');
                } else {
                    adminSectionHeader.classList.add('hidden');
                    adminSection.classList.add('hidden');
                }
            } else {
                // If not logged in, redirect to index.html and hide the dashboard card
                window.location.href = 'index.html';
                if (dashboardContentCard) {
                    dashboardContentCard.classList.add('hidden');
                }
            }
        }

        // Initialize Firebase authentication and set up logout functionality
        function initAuth() {
            try {
                const auth = firebase.auth();

                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', (e) => {
                        e.preventDefault(); // Prevent any default link behavior
                        auth.signOut().then(() => {
                            window.location.href = 'index.html';
                        }).catch(error => {
                            console.error("Logout error:", error);
                        });
                    });
                } else {
                    console.error("Logout button not found!");
                }

                auth.onAuthStateChanged(user => {
                    handleAuthState(user);
                });

            } catch (error) {
                console.error("Auth initialization error:", error);
                window.location.href = 'index.html'; // Redirect if Firebase fails to load
            }
        }

        // Tips modal functionality
        function initTipsModal() {
            const tipsBtn = document.getElementById('tipsBtn'); // This button doesn't exist in the new HTML, so modal won't open from a button.
            const tipsModal = document.getElementById('tipsModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalOverlay = document.getElementById('modalOverlay');
            const gotItBtn = document.getElementById('gotItBtn'); // New button to close modal

            // No specific button to open tips modal, it would need to be triggered otherwise (e.g., on first visit)
            // If you want a button to open it, add a <button id="tipsBtn" class="btn primary">Show Tips</button> somewhere

            // Function to close modal with fade effect
            function closeModalWithFade() {
                tipsModal.classList.add('fade-out');
                setTimeout(() => {
                    tipsModal.style.display = 'none';
                    tipsModal.classList.remove('fade-out');
                }, 300); // Match this to animation duration
            }

            // Close modal when clicking the close button
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => {
                    closeModalWithFade();
                });
            }

            // Close modal when clicking the "Got it!" button
            if (gotItBtn) {
                gotItBtn.addEventListener('click', () => {
                    closeModalWithFade();
                });
            }

            // Close modal when clicking outside the modal content
            if (modalOverlay) {
                modalOverlay.addEventListener('click', () => {
                    closeModalWithFade();
                });
            }

            // Close modal when pressing Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && tipsModal.style.display === 'block') {
                    closeModalWithFade();
                }
            });

             // Optionally, display the modal on page load for new users or specific conditions
             // For now, we'll make it visible upon page load as a "welcome" based on the prompt
             // You would typically use localStorage to check if a user has seen it before
             setTimeout(() => {
                 tipsModal.classList.remove('fade-out');
                 tipsModal.style.display = 'block';
             }, 500); // Show after a short delay
        }

        // Initialize both auth and tips modal functionality
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof firebase !== 'undefined') {
                initAuth();
            } else {
                console.error("Firebase SDK not loaded.");
                const notice = document.getElementById('authNotice');
                if (notice) {
                    notice.textContent = 'Error loading application components. Please try again later.';
                    notice.classList.remove('hidden');
                }
                // Hide the dashboard content card if Firebase fails to load
                const dashboardContentCard = document.querySelector('.dashboard-content-card');
                if (dashboardContentCard) {
                    dashboardContentCard.classList.add('hidden');
                }
            }

            initTipsModal();
        });
    </script>
</body>
</html>
