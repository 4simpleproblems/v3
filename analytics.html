<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4SP | Analytics</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    :root {
      --primary-action: var(--dark-bg);
      --secondary-action-text: var(--dark-bg);
      --secondary-action-bg: var(--light-gray);
      --danger-action: var(--primary-red);
      --light-text: #f0f0f0;
      --dark-bg: #1a1a1a;
      --light-gray: #e0e0e0;
      --medium-gray: #333333;
      --darker-bg: #0d0d0d;
      --error-red: #ff1212;
      --info-text: var(--medium-gray);
      --card-bg: white;
      --card-border: var(--light-gray);
      --pill-radius: 50px;
      --modal-bg: rgba(0, 0, 0, 0.7);
      --modal-content-bg: #222;
      --modal-content-border: #666;
      --modal-text-color: #ddd;
      --modal-input-bg: #444;
      --modal-input-text-color: #eee;
      --primary-red: #ff1212;
      --dark-red: #8b0000;
      --chart-blue: #3498db;
      --chart-green: #2ecc71;
      --chart-orange: #e67e22;
      --chart-purple: #9b59b6;
      --chart-yellow: #f1c40f;
    }

    body {
      background-color: var(--light-gray);
      font-family: 'Roboto Mono', monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: var(--dark-bg);
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
      flex: 1;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: var(--dark-bg);
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 3rem;
      background-color: var(--darker-bg);
      color: var(--light-text);
      border-bottom: 1px solid var(--accent);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: -1.5px;
    }

    .nav-buttons {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn {
      display: inline-block;
      padding: 1rem 2rem;
      border-radius: 50px;
      font-size: 1rem;
      cursor: pointer;
      text-align: center;
      border: 2px solid transparent;
      font-weight: 500;
    }

    .btn.primary {
      background-color: var(--dark-bg);
      color: var(--light-text);
    }

    .btn.secondary {
      background-color: transparent;
      color: var(--light-text);
      border-color: var(--light-text);
    }

    .btn:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    footer {
      text-align: center;
      padding: 1rem;
      background-color: var(--dark-bg);
      color: var(--light-text);
      border-top: 2px solid var(--primary-action);
    }

    /* Analytics Page Specific Styles */
    .analytics-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .date-filter {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .date-filter select {
      padding: 0.75rem 1.5rem;
      border-radius: var(--pill-radius);
      border: 1px solid var(--medium-gray);
      background-color: var(--card-bg);
      font-family: 'Roboto Mono', monospace;
      font-size: 0.9rem;
    }

    .stats-overview {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background-color: var(--card-bg);
      border-radius: var(--pill-radius);
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--card-border);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      margin: 0.5rem 0;
      color: var(--darker-bg);
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--info-text);
    }

    .trend {
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }

    .trend.up {
      color: var(--chart-green);
    }

    .trend.down {
      color: var(--primary-red);
    }

    .charts-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .chart-container {
      background-color: var(--card-bg);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--card-border);
    }

    .chart-container h2 {
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
      color: var(--darker-bg);
    }

    .chart-wrapper {
      position: relative;
      height: 300px;
    }

    .data-table {
      background-color: var(--card-bg);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--card-border);
      margin-bottom: 2rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.9rem;
    }

    table th, table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--light-gray);
    }

    table th {
      font-weight: 700;
      color: var(--darker-bg);
    }

    table tr:last-child td {
      border-bottom: none;
    }

    .data-table h2 {
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
      color: var(--darker-bg);
    }

    .map-container {
      background-color: var(--card-bg);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--card-border);
      height: 400px;
    }

    .map-container h2 {
      margin-top: 0;
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
      color: var(--darker-bg);
    }

    .map-placeholder {
      height: 300px;
      background-color: var(--light-gray);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--info-text);
      font-style: italic;
    }

    @media (max-width: 992px) {
      .stats-overview {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 576px) {
      .stats-overview {
        grid-template-columns: 1fr;
      }
      
      .analytics-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .date-filter {
        width: 100%;
        justify-content: space-between;
      }
    }

    .loading {
      text-align: center;
      padding: 2rem;
      font-style: italic;
      color: var(--info-text);
    }

    .world-map-container {
      width: 100%;
      height: 300px;
      background-color: var(--light-gray);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .world-map {
      width: 100%;
      height: 100%;
      background-color: #e8f4f8;
      position: relative;
    }

    .region {
      fill: #a8d5e5;
      stroke: #fff;
      stroke-width: 0.5;
      cursor: pointer;
      transition: fill 0.3s ease;
    }

    .region:hover {
      fill: var(--chart-blue);
    }

    .region-marker {
      fill: var(--chart-red);
      stroke: white;
      stroke-width: 1;
    }

    .data-point {
      width: 8px;
      height: 8px;
      background-color: var(--primary-red);
      border-radius: 50%;
      position: absolute;
      transform: translate(-50%, -50%);
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="logo">4SP</div>
    <div class="nav-buttons">
      <a href="index.html" class="btn secondary">Home</a>
      <a href="dashboard.html" class="btn secondary">Dashboard</a>
      <a href="analytics.html" class="btn primary">Analytics</a>
      <a href="account.html" class="btn secondary">Account</a>
      <button class="btn secondary" id="logoutBtn">Log Out</button>
    </div>
  </nav>

  <main class="container">
    <div class="analytics-header">
      <h1>Platform Analytics</h1>
      <div class="date-filter">
        <label for="timeframe">Timeframe:</label>
        <select id="timeframe">
          <option value="7d">Last 7 Days</option>
          <option value="30d" selected>Last 30 Days</option>
          <option value="3m">Last 3 Months</option>
          <option value="6m">Last 6 Months</option>
          <option value="1y">Last Year</option>
        </select>
      </div>
    </div>

    <div class="stats-overview">
      <div class="stat-card" data-stat="totalUsers">
        <div class="stat-label">Total Users</div>
        <div class="stat-value">Loading...</div>
        <div class="trend up">+0.0% ↑</div>
      </div>
      <div class="stat-card" data-stat="activeSessions">
        <div class="stat-label">Active Sessions</div>
        <div class="stat-value">Loading...</div>
        <div class="trend up">+0.0% ↑</div>
      </div>
      <div class="stat-card" data-stat="avgSessionTime">
        <div class="stat-label">Avg. Session Time</div>
        <div class="stat-value">Loading...</div>
        <div class="trend up">+0.0% ↑</div>
      </div>
      <div class="stat-card" data-stat="conversionRate">
        <div class="stat-label">Conversion Rate</div>
        <div class="stat-value">Loading...</div>
        <div class="trend down">+0.0% ↑</div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-container">
        <h2>User Activity Over Time</h2>
        <div class="chart-wrapper">
          <canvas id="activityChart"></canvas>
        </div>
      </div>
      <div class="chart-container">
        <h2>User Distribution</h2>
        <div class="chart-wrapper">
          <canvas id="userDistributionChart"></canvas>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <h2>Performance Metrics</h2>
      <div class="chart-wrapper">
        <canvas id="performanceChart"></canvas>
      </div>
    </div>

    <div class="data-table">
      <h2>Top Performing Regions</h2>
      <table id="regionsTable">
        <thead>
          <tr>
            <th>Region</th>
            <th>Users</th>
            <th>Sessions</th>
            <th>Avg. Time</th>
            <th>Conversion</th>
          </tr>
        </thead>
  </main>

  <footer>
    <p>© 2025 4SP</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Firebase Initialization
      const auth = firebase.auth();

      // Check Authentication Status
      auth.onAuthStateChanged(user => {
        if (!user) {
          // Redirect to login page if user is not logged in
          window.location.href = 'login.html';
        } else {
          // User is logged in, load the analytics data
          loadAnalyticsData();
        }
      });

      // Logout functionality
      const logoutBtn = document.getElementById('logoutBtn');
      logoutBtn.addEventListener('click', async () => {
        try {
          await auth.signOut();
          window.location.href = 'index.html';
        } catch (error) {
          console.error('Error signing out: ', error);
          alert('Failed to log out. Please try again.');
        }
      });

      // Initialize charts and load mock data
      function loadAnalyticsData() {
        // Time filter change event
        const timeframeSelect = document.getElementById('timeframe');
        timeframeSelect.addEventListener('change', () => {
          updateCharts(timeframeSelect.value);
          // You would normally fetch new data based on timeframe here
        });

        // Initialize charts with default timeframe (30d)
        initializeCharts('30d');
        drawWorldMap();
      }

      async function initializeCharts(timeframe) {
        try {
          // Get Firestore reference
          const db = firebase.firestore();
          let startDate;
          const now = new Date();
          
          // Calculate start date based on timeframe
          switch(timeframe) {
            case '7d': 
              startDate = new Date(now.getTime() - (7 * 24 * 60 * 60 * 1000));
              break;
            case '30d': 
              startDate = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
              break;
            case '3m': 
              startDate = new Date(now.getTime() - (90 * 24 * 60 * 60 * 1000));
              break;
            case '6m': 
              startDate = new Date(now.getTime() - (180 * 24 * 60 * 60 * 1000));
              break;
            case '1y': 
              startDate = new Date(now.getTime() - (365 * 24 * 60 * 60 * 1000));
              break;
            default: 
              startDate = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
          }

          // Fetch analytics data from Firestore
          const analyticsRef = db.collection('analytics');
          
          // Get user activity data
          const userActivitySnapshot = await analyticsRef
            .doc('userActivity')
            .collection('daily')
            .where('date', '>=', startDate)
            .orderBy('date')
            .get();
          
          // Process user activity data
          const dates = [];
          const activeUsers = [];
          const newRegistrations = [];
          
          userActivitySnapshot.forEach(doc => {
            const data = doc.data();
            dates.push(data.date.toDate().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            activeUsers.push(data.activeUsers || 0);
            newRegistrations.push(data.newRegistrations || 0);
          });
          
          // If no data is found, use the last 30 days with placeholder data
          if (dates.length === 0) {
            const dateLabels = generateDateLabels(30);
            dates.push(...dateLabels);
            
            // Generate consistent placeholder data
            for (let i = 0; i < 30; i++) {
              // Use deterministic values based on date
              const dayOfMonth = new Date(dateLabels[i]).getDate();
              activeUsers.push(2000 + (dayOfMonth * 50));
              newRegistrations.push(100 + (dayOfMonth * 10));
            }
          }

          // Get user device distribution data
          const deviceDistributionSnapshot = await analyticsRef.doc('deviceDistribution').get();
          let deviceData = { desktop: 0, mobile: 0, tablet: 0 };
          
          if (deviceDistributionSnapshot.exists) {
            deviceData = deviceDistributionSnapshot.data();
          } else {
            // Use placeholder data with slight variance by day of month
            const dayOfMonth = now.getDate();
            deviceData = { 
              desktop: 55 + (dayOfMonth % 10), 
              mobile: 35 - (dayOfMonth % 5), 
              tablet: 10 - (dayOfMonth % 5)
            };
          }

          // Get performance metrics data
          const performanceSnapshot = await analyticsRef.doc('performance').get();
          let performanceData = {
            pageLoad: 0,
            apiResponse: 0,
            databaseQuery: 0,
            processing: 0,
            rendering: 0
          };
          
          if (performanceSnapshot.exists) {
            performanceData = performanceSnapshot.data();
          } else {
            // Use placeholder data with variance based on hour of day
            const hourOfDay = now.getHours();
            performanceData = {
              pageLoad: 300 + (hourOfDay * 2),
              apiResponse: 140 + (hourOfDay),
              databaseQuery: 95 + (hourOfDay * 0.5),
              processing: 200 + (hourOfDay * 1.5),
              rendering: 170 + (hourOfDay)
            };
          }

          // User Activity Chart (Line Chart)
          const activityCtx = document.getElementById('activityChart').getContext('2d');
          const activityChart = new Chart(activityCtx, {
            type: 'line',
            data: {
              labels: dates,
              datasets: [
                {
                  label: 'Daily Active Users',
                  data: activeUsers,
                  borderColor: '#3498db',
                  backgroundColor: 'rgba(52, 152, 219, 0.1)',
                  borderWidth: 2,
                  tension: 0.3,
                  fill: true
                },
                {
                  label: 'New Registrations',
                  data: newRegistrations,
                  borderColor: '#2ecc71',
                  backgroundColor: 'rgba(46, 204, 113, 0.1)',
                  borderWidth: 2,
                  tension: 0.3,
                  fill: true
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'top',
                },
                tooltip: {
                  mode: 'index',
                  intersect: false,
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                  }
                },
                x: {
                  grid: {
                    display: false
                  }
                }
              }
            }
          });

          // User Distribution Chart (Doughnut/Pie Chart)
          const userDistributionCtx = document.getElementById('userDistributionChart').getContext('2d');
          const userDistributionChart = new Chart(userDistributionCtx, {
            type: 'doughnut',
            data: {
              labels: ['Desktop', 'Mobile', 'Tablet'],
              datasets: [{
                data: [deviceData.desktop, deviceData.mobile, deviceData.tablet],
                backgroundColor: [
                  'rgba(52, 152, 219, 0.8)',
                  'rgba(46, 204, 113, 0.8)',
                  'rgba(155, 89, 182, 0.8)'
                ],
                borderColor: [
                  'rgba(52, 152, 219, 1)',
                  'rgba(46, 204, 113, 1)',
                  'rgba(155, 89, 182, 1)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                }
              }
            }
          });

          // Performance Metrics Chart (Bar Chart)
          const performanceCtx = document.getElementById('performanceChart').getContext('2d');
          const performanceChart = new Chart(performanceCtx, {
            type: 'bar',
            data: {
              labels: ['Page Load', 'API Response', 'Database Query', 'Processing', 'Rendering'],
              datasets: [{
                label: 'Average Time (ms)',
                data: [
                  performanceData.pageLoad, 
                  performanceData.apiResponse, 
                  performanceData.databaseQuery, 
                  performanceData.processing, 
                  performanceData.rendering
                ],
                backgroundColor: 'rgba(230, 126, 34, 0.8)',
                borderColor: 'rgba(230, 126, 34, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'Time (ms)'
                  },
                  grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                  }
                },
                x: {
                  grid: {
                    display: false
                  }
                }
              }
            }
          });
          
          // Update stats overview with real data
          updateStatsOverview();

        } catch (error) {
          console.error("Error loading charts data:", error);
          // Fallback to placeholder data if there's an error
          showPlaceholderData();
        }
      }
      
      // Function to update the stats overview section with real data
      async function updateStatsOverview() {
        try {
          const db = firebase.firestore();
          const statsSnapshot = await db.collection('analytics').doc('stats').get();
          
          if (statsSnapshot.exists) {
            const stats = statsSnapshot.data();
            
            // Update DOM elements with real data
            document.querySelector('[data-stat="totalUsers"] .stat-value').textContent = 
              formatNumber(stats.totalUsers || 0);
            document.querySelector('[data-stat="activeSessions"] .stat-value').textContent = 
              formatNumber(stats.activeSessions || 0);
            document.querySelector('[data-stat="avgSessionTime"] .stat-value').textContent = 
              formatTime(stats.avgSessionTime || 0);
            document.querySelector('[data-stat="conversionRate"] .stat-value').textContent = 
              `${(stats.conversionRate || 0).toFixed(1)}%`;
            
            // Update trends
            updateTrendIndicator('totalUsers', stats.totalUsersTrend || 0);
            updateTrendIndicator('activeSessions', stats.activeSessionsTrend || 0);
            updateTrendIndicator('avgSessionTime', stats.avgSessionTimeTrend || 0);
            updateTrendIndicator('conversionRate', stats.conversionRateTrend || 0);
          } else {
            // Use placeholder data with real-time variations
            const now = new Date();
            const hourOfDay = now.getHours();
            const dayOfMonth = now.getDate();
            
            const placeholderStats = {
              totalUsers: 10000 + (dayOfMonth * 100),
              totalUsersTrend: 12.5 + (hourOfDay * 0.1),
              activeSessions: 3000 + (hourOfDay * 50),
              activeSessionsTrend: 8.7 - (hourOfDay * 0.05),
              avgSessionTime: 15 * 60 + (dayOfMonth * 10),
              avgSessionTimeTrend: 3.2 - (hourOfDay * 0.1),
              conversionRate: 8.5 + (dayOfMonth * 0.05),
              conversionRateTrend: -1.4 - (hourOfDay * 0.03)
            };
            
            document.querySelector('[data-stat="totalUsers"] .stat-value').textContent = 
              formatNumber(placeholderStats.totalUsers);
            document.querySelector('[data-stat="activeSessions"] .stat-value').textContent = 
              formatNumber(placeholderStats.activeSessions);
            document.querySelector('[data-stat="avgSessionTime"] .stat-value').textContent = 
              formatTime(placeholderStats.avgSessionTime);
            document.querySelector('[data-stat="conversionRate"] .stat-value').textContent = 
              `${placeholderStats.conversionRate.toFixed(1)}%`;
            
            updateTrendIndicator('totalUsers', placeholderStats.totalUsersTrend);
            updateTrendIndicator('activeSessions', placeholderStats.activeSessionsTrend);
            updateTrendIndicator('avgSessionTime', placeholderStats.avgSessionTimeTrend);
            updateTrendIndicator('conversionRate', placeholderStats.conversionRateTrend);
          }
          
          // Update table data
          await updateRegionsTable();
          
        } catch (error) {
          console.error("Error updating stats overview:", error);
        }
      }
      
      // Update trend indicators
      function updateTrendIndicator(statId, trendValue) {
        const trendElement = document.querySelector(`[data-stat="${statId}"] .trend`);
        if (trendValue >= 0) {
          trendElement.textContent = `+${trendValue.toFixed(1)}% ↑`;
          trendElement.className = 'trend up';
        } else {
          trendElement.textContent = `${trendValue.toFixed(1)}% ↓`;
          trendElement.className = 'trend down';
        }
      }
      
      // Format number with commas
      function formatNumber(number) {
        return new Intl.NumberFormat().format(number);
      }
      
      // Format seconds to MM:SS
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
      }
      
      // Update regions table with actual data
      async function updateRegionsTable() {
        try {
          const db = firebase.firestore();
          const regionsSnapshot = await db.collection('analytics').doc('regions').collection('data').get();
          
          if (!regionsSnapshot.empty) {
            const tableBody = document.querySelector('#regionsTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows
            
            regionsSnapshot.forEach(doc => {
              const region = doc.data();
              const row = document.createElement('tr');
              
              row.innerHTML = `
                <td>${region.name}</td>
                <td>${formatNumber(region.users || 0)}</td>
                <td>${formatNumber(region.sessions || 0)}</td>
                <td>${formatTime(region.avgTime || 0)}</td>
                <td>${(region.conversion || 0).toFixed(1)}%</td>
              `;
              
              tableBody.appendChild(row);
            });
          }
        } catch (error) {
          console.error("Error updating regions table:", error);
        }
      }
      
      // Fallback to placeholder data if Firestore data isn't available
      function showPlaceholderData() {
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        const activityChart = new Chart(activityCtx, {
          type: 'line',
          data: {
            labels: generateDateLabels(30),
            datasets: [
              {
                label: 'Daily Active Users',
                data: generateDeterministicData(30, 2000, 3500),
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                borderWidth: 2,
                tension: 0.3,
                fill: true
              },
              {
                label: 'New Registrations',
                data: generateDeterministicData(30, 100, 500),
                borderColor: '#2ecc71',
                backgroundColor: 'rgba(46, 204, 113, 0.1)',
                borderWidth: 2,
                tension: 0.3,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top',
              },
              tooltip: {
                mode: 'index',
                intersect: false,
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });

        const userDistributionCtx = document.getElementById('userDistributionChart').getContext('2d');
        const userDistributionChart = new Chart(userDistributionCtx, {
          type: 'doughnut',
          data: {
            labels: ['Desktop', 'Mobile', 'Tablet'],
            datasets: [{
              data: [58, 35, 7],
              backgroundColor: [
                'rgba(52, 152, 219, 0.8)',
                'rgba(46, 204, 113, 0.8)',
                'rgba(155, 89, 182, 0.8)'
              ],
              borderColor: [
                'rgba(52, 152, 219, 1)',
                'rgba(46, 204, 113, 1)',
                'rgba(155, 89, 182, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
              }
            }
          }
        });

        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        const performanceChart = new Chart(performanceCtx, {
          type: 'bar',
          data: {
            labels: ['Page Load', 'API Response', 'Database Query', 'Processing', 'Rendering'],
            datasets: [{
              label: 'Average Time (ms)',
              data: [320, 145, 98, 215, 178],
              backgroundColor: 'rgba(230, 126, 34, 0.8)',
              borderColor: 'rgba(230, 126, 34, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Time (ms)'
                },
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
      
      // Generate deterministic data based on date
      function generateDeterministicData(count, min, max) {
        const data = [];
        const today = new Date();
        const range = max - min;
        
        for (let i = 0; i < count; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() - (count - 1) + i);
          
          // Use date components to generate deterministic but varying values
          const dayValue = date.getDate() / 31; // 0-1 range based on day of month
          const monthValue = date.getMonth() / 12; // 0-1 range based on month
          
          // Create a value that varies but is deterministic for the same date
          const value = Math.floor(min + (range * (0.5 + Math.sin(dayValue * 10) * 0.3 + Math.cos(monthValue * 8) * 0.2)));
          data.push(value);
        }
        
        return data;
      }

      function updateCharts(timeframe) {
        // In a real implementation, you would fetch new data
        // For now, we'll just update with new random data
        
        // Get number of days based on timeframe
        let days;
        switch(timeframe) {
          case '7d': days = 7; break;
          case '30d': days = 30; break;
          case '3m': days = 90; break;
          case '6m': days = 180; break;
          case '1y': days = 365; break;
          default: days = 30;
        }
        
        // Update user activity chart
        const activityChart = Chart.getChart('activityChart');
        if (activityChart) {
          activityChart.data.labels = generateDateLabels(days);
          activityChart.data.datasets[0].data = generateRandomData(days, 2000, 3500);
          activityChart.data.datasets[1].data = generateRandomData(days, 100, 500);
          activityChart.update();
        }
      }

      // Helper function to generate date labels
      function generateDateLabels(days) {
        const labels = [];
        const today = new Date();
        
        for (let i = days - 1; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(today.getDate() - i);
          labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        }
        
        return labels;
      }

      // Helper function to generate random data
      function generateRandomData(count, min, max) {
        const data = [];
        for (let i = 0; i < count; i++) {
          data.push(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return data;
      }

      // Draw a simplified world map
      function drawWorldMap() {
        const regions = [
          { id: 'na', name: 'North America', path: 'M200,120 L300,120 L350,200 L250,280 L150,250 Z', users: 5243 },
          { id: 'sa', name: 'South America', path: 'M250,280 L300,380 L250,450 L200,380 Z', users: 698 },
          { id: 'eu', name: 'Europe', path: 'M450,120 L550,100 L580,180 L450,200 Z', users: 3892 },
          { id: 'af', name: 'Africa', path: 'M450,200 L550,200 L600,350 L450,350 Z', users: 261 },
          { id: 'as', name: 'Asia', path: 'M580,180 L800,150 L850,300 L600,350 L580,180 Z', users: 2453 },
          { id: 'au', name: 'Australia', path: 'M800,350 L900,320 L850,420 L750,400 Z', users: 950 }
        ];

        // Draw regions
        const regionsGroup = document.getElementById('regions');
        regions.forEach(region => {
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          path.setAttribute('d', region.path);
          path.setAttribute('class', 'region');
          path.setAttribute('id', region.id);
          path.setAttribute('data-name', region.name);
          path.setAttribute('data-users', region.users);
          
          // Add tooltip behavior
          path.addEventListener('mouseover', (e) => {
            const name = e.target.getAttribute('data-name');
            const users = e.target.getAttribute('data-users');
            showTooltip(name, users, e.clientX, e.clientY);
          });
          
          path.addEventListener('mouseout', () => {
            hideTooltip();
          });
          
          regionsGroup.appendChild(path);
        });

        // Add user data points
        const dataPoints = [
          { x: 270, y: 150, size: 12 }, // North America
          { x: 520, y: 140, size: 10 }, // Europe
          { x: 700, y: 220, size: 8 }, // Asia
          { x: 250, y: 350, size: 6 }, // South America
          { x: 500, y: 270, size: 5 }, // Africa
          { x: 830, y: 380, size: 7 }  // Australia
        ];

        const markersGroup = document.getElementById('markers');
        dataPoints.forEach(point => {
          const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          circle.setAttribute('cx', point.x);
          circle.setAttribute('cy', point.y);
          circle.setAttribute('r', point.size / 2);
          circle.setAttribute('class', 'region-marker');
          markersGroup.appendChild(circle);
        });
      }

      // Tooltip functions (simplified)
      function showTooltip(name, users, x, y) {
        // In a real implementation, you would show a tooltip
        console.log(`${name}: ${users} users`);
      }

      function hideTooltip() {
        // Hide tooltip
      }
    });
  </script>

</body>

</html>
