<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>4SP | User Count</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <style>
    body { background: var(--light-gray); font-family: 'Roboto Mono', monospace; }
    .container { max-width: 600px; margin: 3rem auto; background: #fff; border-radius: 2rem; box-shadow: 0 2px 12px rgba(0,0,0,.07); padding: 2rem; }
    h1 { text-align: center; }
    #userCount { font-size: 2.5rem; font-weight: 700; color: var(--primary-red); text-align: center; }
    .admin-controls { margin: 2rem 0; text-align: center; }
    .admin-controls input { width: 80px; font-size: 1.2rem; padding: .5rem; border-radius: 1rem; border: 1px solid #ccc; margin-right: .5rem; }
    .admin-controls button { padding: .5rem 1.5rem; border-radius: 1rem; background: var(--dark-bg); color: #fff; border: none; font-weight: 500; cursor: pointer; }
    .admin-controls button:hover { background: var(--primary-red); }
    .note { color: #666; font-size: .95rem; text-align: center; }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">4SP</div>
    <div class="nav-buttons">
      <a href="index.html" class="btn secondary">Home</a>
      <a href="dashboard.html" class="btn secondary">Dashboard</a>
      <a href="account.html" class="btn secondary">Account</a>
    </div>
  </nav>
  <div class="container">
    <h1>Current User Count</h1>
    <div id="userCount">Loading...</div>
    <div id="adminControls" class="admin-controls" style="display:none;">
      <input type="number" id="manualCount" min="0">
      <button id="updateCountBtn">Update Count</button>
      <div class="note">Admins can manually set the user count here.</div>
    </div>
    <div class="note" id="autoNote" style="display:none;">
      The user count will automatically increase by 1 when someone signs up.
    </div>
  </div>
  <footer>
    <p>Â© 2025 4SP</p>
  </footer>
  <script>
    // Firebase
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Change this to your admin UIDs or use a Firestore "admins" collection
    const ADMIN_UIDS = ['YOUR_ADMIN_UID_HERE'];

    // DOM
    const userCountEl = document.getElementById('userCount');
    const adminControls = document.getElementById('adminControls');
    const manualCountInput = document.getElementById('manualCount');
    const updateCountBtn = document.getElementById('updateCountBtn');
    const autoNote = document.getElementById('autoNote');

    // Listen to user count in real-time
    function listenToUserCount() {
      db.doc('siteData/userCount').onSnapshot(doc => {
        if (doc.exists) {
          userCountEl.textContent = doc.data().count;
          manualCountInput.value = doc.data().count;
        } else {
          userCountEl.textContent = '0';
          manualCountInput.value = 0;
        }
      });
    }

    // Update user count manually (admin only)
    updateCountBtn.addEventListener('click', () => {
      const newCount = parseInt(manualCountInput.value, 10);
      if (!isNaN(newCount) && newCount >= 0) {
        db.doc('siteData/userCount').set({ count: newCount });
      }
    });

    // Auth state
    auth.onAuthStateChanged(async user => {
      listenToUserCount();
      if (user) {
        // Check admin (you can use a Firestore collection instead for production)
        if (ADMIN_UIDS.includes(user.uid)) {
          adminControls.style.display = '';
          autoNote.style.display = '';
        } else {
          adminControls.style.display = 'none';
          autoNote.style.display = '';
        }
      } else {
        adminControls.style.display = 'none';
        autoNote.style.display = '';
      }
    });
  </script>
</body>
</html>
