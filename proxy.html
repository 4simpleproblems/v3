<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Service-Worker-Allowed" content="/" />
  <title>4SP TEST</title>
  <style>
    #loader { /* same as before */ }
    #content { display:none; }
  </style>
</head>
<body>
  <div id="loader">Loadingâ€¦</div>
  <div id="content"></div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js', { scope: '/' })
        .catch(err => console.error('SW registration failed:', err));

      // Use `ready` to run as soon as SW is controlling the page
      navigator.serviceWorker.ready
        .then(registration => {
          console.log('SW ready, controlling:', registration.active);
          document.getElementById('loader').style.display = 'none';
          document.getElementById('content').style.display = 'block';
          // Trigger navigation through SW
          window.location.href = window.location.href;
        })
        .catch(err => console.error('SW ready promise rejected:', err));
    } else {
      console.warn('Service Workers unsupported');
    }
  </script>
</body>
</html>
